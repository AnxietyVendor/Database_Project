# 数据库第二次作业

## 1. 数据设计

用户（<u>身份证号</u>，出生年月，姓名，电话，地址，邮箱，性别，邮编）

账户（<u>账号</u>，销户记录，账户余额）

储蓄卡（<u>卡号</u>， 主卡/副卡）

历史计息记录 （<u>账号</u>，上次计息日， 本次计息日， 计息金额）

交易历史记录 （<u>账号</u>，<u>卡号</u>，对方账号， 主卡/副卡，存入/取出/转账，金额，交易前余额，交易后余额，摘要）



![image-20200410190524787](C:\Users\mi\AppData\Roaming\Typora\typora-user-images\image-20200410190524787.png)

## 2. 功能设计

1. 开户：

	*  在用户表中以元组的形式插入账户持有者的基本信息

	* 在账户表中插入新账户相关信息
	* 在储蓄卡表中插入新账户对应储蓄卡的信息
	* 在交易历史记录中插入信息（摘要处为"开户"）

2. 销户

	* 在用户表中删除账户持有者对应的元组
	* 在账户表中删除账户对应元组
	* 在储蓄卡表中删除对应储蓄卡信息
	* 在交易历史记录中插入信息（摘要处为"销户"）

3. 存入

	* 重新计算账户余额
	* 在交易历史中记录存入操作，摘要部分记录为“存入”

4. 取出

	* 判断当前账户余额是否大于等于取出金额，若否，则拒绝操作
	* 重新计算账户余额
	* 在交易历史中记录存入操作，摘要部分记录为“取出”

5. 转账

	* 判断当前账户余额是否大于等于转账金额，若否，则拒绝操作
	* 重新计算账户余额
	* 在交易历史中记录存入操作，摘要部分记录为“转账”

6. 记录交易历史

	* 在交易历史记录表中以元组形式插入操作的相关信息

7. 账户计息

	* 查询账户计息表中最后一条元组中本次计息日之后对应的所有交易历史
	* 计算出这段时间内该账户余额随时间的变动关系
	* 计算出不同时段不同账户余额的利息和作为账户利息
	* 记录计息历史，包括账户、上次计息日、本次计息日、计息金额
	* 在交易历史记录计息操作，存入计算利息，摘要部分记为“利息”

